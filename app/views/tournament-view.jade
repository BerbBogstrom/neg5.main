extends layout

block extrastylesheets
    link(rel="stylesheet" href="/css/home.css")
    link(rel="stylesheet" href="/css/tournamentstyle.css")

block content

    //+navbar
    +sidebar

    - var dateConverter = function(date) {
    -    var day = date.getDate();
    -    var month = date.getMonth() + 1;
    -    var year = date.getFullYear();
    -
    -    if (day < 10) {
    -        day = "0" + day;
    -    }
    -    if (month < 10) {
    -        month = "0" + month;
    -    }
    -    var formattedDate = year + "-" + month + "-" + day;
    -    return formattedDate;
    - }

    main(class="cd-main-content")
        div(class="content-wrapper box")
            input(type="hidden" id="tournamentshortid" value="#{tournament.shortID}")
            div(class="row")
                    div(class="col-md-12")
                        div(style="margin:20px; margin-bottom:50px")
                        h2(class="title" style="width:50%") #{tournament.tournament_name}

                        div(class="panel-body")
                            div(class="row" style="")
                                ul(class="nav nav-pills no-border-radius")
                                    li(class="active")
                                        a(href="#overview" data-toggle="tab") Overview
                                    li
                                        a(href="#games" data-toggle="tab") Add/Remove/Edit Games
                                    li
                                        a(href="#teams" data-toggle="tab") Add/Remove/Edit Teams
                                    li
                                        a(href="#stats" data-toggle="tab") Statistics
                        br
                        br

                        div(class="tab-content")
                            div(class="tab-pane fade active in" id="overview")
                                div(class="panel panel-default")
                                    div(class="panel-heading collapsable") Tournament Overview
                                    div(class="panel-body")
                                        form(id="tournament-overview-form")
                                            input(type="hidden" value="#{tournament._id}" name="tournamentid")
                                            div(class="col-md-6")
                                                    label(class="label label-primary col-xs-4") Name
                                                    div(class="form-group col-xs-8")
                                                        input(
                                                            type="text",
                                                            name="tournament_name",
                                                            value="#{tournament.tournament_name}",
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                    label(class="label label-primary col-xs-4") Location
                                                    div(class="form-group col-xs-8")
                                                        input(
                                                            type="text",
                                                            name="tournament_location",
                                                            value="#{tournament.location}",
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                    label(class="label label-primary col-xs-4") Date
                                                    div(class="form-group col-xs-8")
                                                        if tournament.date
                                                            input(
                                                                type="date",
                                                                name="tournament_date",
                                                                value="#{dateConverter(tournament.date)}",
                                                                class="form-control input-medium center-text no-border-radius"
                                                            )
                                                        else
                                                            input(
                                                                type="date",
                                                                name="tournament_date",
                                                                class="form-control input-medium center-text no-border-radius"
                                                            )
                                                    div(class="col-md-6")
                                                        button(type="button" class="btn btn-lg btn-success" id="edittournamentbutton") Save Changes
                                                        div(id="tournament-update-msgdiv")
                                                            p(style="margin:10px; font-size:18px")

                                div(class="panel panel-default")
                                    div(class="panel-heading collapsable") Divisions and Point Scheme
                                    div(class="panel-body")
                                        div(class="col-md-6")
                                            label(class="label label-primary col-xs-4") Point Scheme
                                            div(class="form-group col-xs-8")
                                                form(id="point-schema-form")
                                                    input(type="hidden" name="tournamentid" value="#{tournament._id}")
                                                    each num, i in Object.keys(tournament.pointScheme)
                                                        div(class="form-group")
                                                            input(type="number" style="width:25%" value="#{num}" class="form-control input-medium no-border-radius" name="val" + num)
                                            div(class="btn-group" style="margin-top:15px")
                                                button(type="button" class="btn btn-md btn-info" style="margin:0;margin-bottom:15px" id="add-point-value-button" onclick='addPointSchemaRow()') Add A Point Value
                                                button(type="button" class="btn btn-md btn-success" style="margin:0;margin-bottom:15px" id="save-point-schema-button") Save Point Scheme

                                        div(class="col-md-6")
                                            label(class="label label-primary col-xs-4") Divisions
                                            div(class="form-group col-xs-8")
                                                form(id="divisions-form")
                                                    input(type="hidden" name="tournamentid" value="#{tournament._id}")
                                                    each divison, i in tournament.divisions
                                                        div(class="form-group")
                                                            input(type='text' style="width:50%" value="#{tournament.divisions[i]}" class='form-control input-medium no-border-radius')
                                            div(class="btn-group" style="margin-top:15px")
                                                button(type="button" class="btn btn-md btn-info" style="margin:0" onclick='addDivisionRow()') Add Division
                                                button(type="button" class="btn btn-md btn-success" style="margin:0" id="save-divisions-button") Save Divisions

                            div(class="tab-pane fade" id="games")
                                div(class="panel panel-default")
                                        div(class="panel-heading collapsable") Add a Game
                                        div(class="panel-body" id="addgamepanel")

                                                form(name="gameinfoform" id="gamedataform")
                                                    input(type="hidden" value="#{JSON.stringify(tournament.pointScheme)}" name="pointValueForm")
                                                    div(class="row")
                                                        input(type="hidden" value="#{tournament._id}" id="tournament_id_change" name="tournament_id_form")
                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                                input(type="hidden" name="leftteamname" id="leftteamnameID")
                                                                select(id="leftchoice" class="form-control teamselect" name="leftteamselect")
                                                                    option(selected value="") Choose a Team
                                                                    each team in tournament.teams
                                                                        option(value="#{team._id}") #{team.team_name}

                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                                input(type="hidden" name="rightteamname" id="rightteamnameID")
                                                                select(id="rightchoice" class="form-control teamselect" name="rightteamselect")
                                                                    option(selected value="") Choose a Team
                                                                    each team in tournament.teams
                                                                        option(value="#{team._id}") #{team.team_name}
                                                    br
                                                    div(class="row")
                                                        div(id="left-text" class="col-lg-6 col-md-6 col-sm-6")
                                                        div(id="right-text" class="col-lg-6 col-md-6 col-sm-6")
                                                    div(class="row")
                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                            input(type="number" class="form-control leftscorebox" name="leftteamscore" placeholder="Team 1 Score")
                                                            input(type="number" class="form-control leftscorebox" name="leftbounceback" placeholder="Bounceback Points")
                                                            br
                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                            input(type="number" class="form-control rightscorebox" name="rightteamscore" placeholder="Team 2 Score")
                                                            input(type="number" class="form-control rightscorebox" name="rightbounceback" placeholder="Bounceback Points")
                                                            br
                                                    div(class="row")
                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                            input(type="number" class="form-control leftscorebox" name="round" placeholder="Round")
                                                    div(class="row")
                                                        div(class="col-lg-6 col-md-6 col-sm-6")
                                                            input(type="number" class="form-control leftscorebox" name="tossupsheard" placeholder="Tossups Heard")
                                                    button(type="button" class="btn btn-lg btn-success" id="entergamebutton") Add Game Information
                                                        span(style="padding-left:10px")
                                                            i(class="glyphicon glyphicon-plus")

                                                    div(id="add-game-message")
                                                        //p(style='margin:10px; font-size:16px; color:#009933') Hello

                                div(class="panel panel-default")
                                        div(class="panel-heading collapsable") List of Games
                                        div(class="panel-body")

                                            div(class="table-responsive" id="gamediv")
                                                div(class="row" style="width:95%")
                                                    div(class="input-group col-lg-2 col-md-2 col-sm-2" style="margin-left:20px;margin-bottom:20px;")

                                                        input(type="text" class="form-control search" placeholder="Filter List")
                                                        span(class="input-group-addon")
                                                            i(class="glyphicon glyphicon-search")
                                                div(class="panel panel-default")
                                                    table(class="table table-striped table-bordered table-hover table-condensed")
                                                        thead
                                                            tr
                                                                th(class="table-head") Round
                                                                th(class="table-head") Team 1
                                                                th(class="table-head") Team 1 Score
                                                                th(class="table-head") Team 2
                                                                th(class="table-head") Team 2 Score
                                                                th(class="table-head") Tossups Heard
                                                                th(class="table-head") Edit
                                                        tbody(id="gametablebody" class="list")
                                                            each val, i in tournament.games
                                                                tr()
                                                                    td(class="round") #{tournament.games[i].round}
                                                                    td(class="team1name") #{tournament.games[i].team1.team_name}
                                                                    td(class="team1score") #{tournament.games[i].team1.score}
                                                                    td(class="team2name") #{tournament.games[i].team2.team_name}
                                                                    td(class="team2score") #{tournament.games[i].team2.score}
                                                                    td(class="tuheard") #{tournament.games[i].tossupsheard}
                                                                    td
                                                                        form()
                                                                            input(type="hidden" name="gameid_form" value='#{tournament.games[i].shortID}')
                                                                            input(type="hidden" name="tournament_idgame" value="#{tournament._id}")
                                                                            a(class="btn btn-sm btn-info editbutton" href="/home/tournaments/" + tournament.shortID + "/games/" + tournament.games[i].shortID) Details
                                                                            button(type="button" class="btn btn-sm btn-warning deletebutton") Remove Game


                            div(class="tab-pane fade" id="teams")
                                div(class="panel panel-default")
                                        div(class="panel-heading collapsable" id="add-team-panel") Add a Team
                                        div(class="panel-body" id="add-team-body")

                                            div(class="col-md-6")
                                                form(id="teamform" name="createTeam")
                                                    input(
                                                        type="hidden",
                                                        name="tournament_id",
                                                        value="#{tournament._id}"
                                                    )
                                                    div(class="form-group")
                                                        label Name*
                                                        input(
                                                            type="text",
                                                            name="team_name",
                                                            id="team_name_input",
                                                            placeholder="Team Name",
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                    div(class="form-group")
                                                        label Division
                                                        select(name="team_division" class="form-control input-medium center-text no-border-radius")
                                                            if (tournament.divisions.length == 0)
                                                                option(value="") No Divisions
                                                            else
                                                                each division, i in tournament.divisions
                                                                    option(value="#{tournament.divisions[i]}") #{division}
                                                    div(id="player-dynamic" class="form-group")
                                                        label Players
                                                        button(type="button" class="btn btn-sm btn-success no-border-radius" id="newlineplayer" style="margin: 5px") Add Player
                                                        input(
                                                            type="hidden",
                                                            id="player_team_dynamic",
                                                            name="players_team",
                                                        )
                                                        input(
                                                            type="text",
                                                            name="player1_name",
                                                            placeholder="Player 1",
                                                            autocomplete="off",
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                        input(
                                                            type="text",
                                                            name="player2_name",
                                                            autocomplete="off",
                                                            class="form-control input-medium center-text no-border-radius"
                                                            placeholder="Player 2",
                                                        )
                                                        input(
                                                            type="text",
                                                            name="player3_name",
                                                            placeholder="Player 3",
                                                            autocomplete="off"
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                        input(
                                                            type="text",
                                                            name="player4_name",
                                                            placeholder="Player 4",
                                                            autocomplete="off",
                                                            class="form-control input-medium center-text no-border-radius"
                                                        )
                                                    br
                                                    button(type="button" class="btn btn-lg btn-info no-border-radius" id="add-team-button") Add Team To Tournament

                                div(class="panel panel-default")
                                        div(class="panel-heading collapsable") List of Teams
                                        div(class="panel-body")

                                            div(class="table-responsive" id="teamdiv")
                                                div(class="row" style="width:95%")
                                                    div(class="input-group col-lg-2 col-md-2 col-sm-2" style="margin-left:20px;margin-bottom:20px;")

                                                        input(type="text" class="form-control search" placeholder="Filter List")
                                                        span(class="input-group-addon")
                                                            i(class="glyphicon glyphicon-search")

                                                div(class="panel panel-default")
                                                    table(class="table table-striped table-bordered table-hover table-condensed")
                                                        thead
                                                            tr
                                                                th(class="table-head") Team
                                                                th(class="table-head") Division
                                                                th(class="table-head") Edit
                                                        tbody(id="teamtablebody" class="list")
                                                            each val, i in tournament.teams
                                                                tr()
                                                                    td(class="teamname") #{tournament.teams[i].team_name}
                                                                    td(class="division") #{tournament.teams[i].division}
                                                                    td
                                                                        form()
                                                                            input(type="hidden" name="teamid_form" value="#{tournament.teams[i].shortID}")
                                                                            input(type="hidden" name="tournament_idteam" value="#{tournament._id}")
                                                                            a(class="btn btn-sm btn-info" href="/home/tournaments/" + tournament.shortID + "/teams/" + tournament.teams[i].shortID) Details
                                                                            button(type="button" class="btn btn-sm btn-warning deleteteambutton") Remove Team

                            div(class="tab-pane fade" id="stats")
                                div(class="panel panel-default")
                                        div(class="panel-heading collapsable") Generate Complete Statistics
                                        div(class="panel-body")

                                            div()
                                                ul(class="nav nav-pills no-border-radius")
                                                    li
                                                        a(target="_blank" href="/home/tournaments/" + tournament.shortID + "/stats/team" class="btn btn-lg btn-stats") Team Stats
                                                    li
                                                        a(target="_blank" href="/home/tournaments/" + tournament.shortID + "/stats/player" class="btn btn-lg btn-stats") Player Stats
                                                    li
                                                        a(target="_blank" href="/home/tournaments/" + tournament.shortID + "/stats/teamfull" class="btn btn-lg btn-stats") Full Report

                                div(class="panel panel-default")
                                    div(class="panel-heading collapsable") Advanced Team Statistics

                                    div(class="panel-body")
                                            div(class="col-md-6")
                                                form(method="post" action="/home/tournaments/" + tournament.shortID + "/stats/filter/teams" id="filterstatsform")
                                                    div(class="form-group")
                                                        label Teams
                                                        br
                                                        br
                                                        select(name="teams[]" class="form-control" size="#{tournament.teams.length}" multiple)
                                                            each val, i in tournament.teams
                                                                option(value="#{tournament.teams[i].shortID}") #{tournament.teams[i].team_name}
                                                    div(class="form-group")
                                                        input(class="form-control" type="number" name="minround" placeholder="Min Round" style="width:40%")
                                                    div(class="form-group")
                                                        input(class="form-control" type="number" name="maxround" placeholder="Max Round" style="width:40%")
                                                    div(class="form-group")
                                                        ul(class="nav nav-pills no-border-radius")
                                                            li
                                                                button(type="button" class="btn btn-lg btn-stats" style="border-radius:5px" id="customteam" class="custombutton") Generate Team Stats
                                                            li
                                                                button(type="button" class="btn btn-lg btn-stats" style="border-radius:5px" id="customplayer" class="custombutton") Generate Player Stats

                                div(class="panel panel-default")
                                    div(class="panel-heading collapsable") Custom Stats Will Display Here

                                    div(class="panel-body")
                                        div(class="col-md-12" id="customstatsdiv" style="margin-top:20px")


    script(src="/js/tournament-configuration.js")
